<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown Timer</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics.js"></script>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center; /* Центрируем по горизонтали */
            justify-content: center; /* Центрируем по вертикали */
            min-height: 100vh; /* Занимает 100% высоты окна */
            margin: 0; /* Убираем отступы */
        }
        .countdown {
            font-size: 24px;
            margin: 10px 0;
        }
        .strikethrough {
            text-decoration: line-through;
            color: gray;
        }
        .task {
            font-size: 18px;
        }
        .subtask {
            font-size: 14px;
            color: lightgray;
        }
        input[type="text"] {
            width: 300px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Отсчет до встречи:</h1>
    <div class="countdown" id="countdownMeeting">00:00:00</div>
    <input type="checkbox" id="checkMeeting" onchange="saveCheckboxState('checkMeeting')"> Завершено

    <h1 class="subtask">Подзадача: До покупки билетов осталось:</h1>
    <div class="countdown" id="countdownTicket">00:00:00</div>
    <input type="checkbox" id="checkTicket" onchange="saveCheckboxState('checkTicket')"> Завершено

    <h1 class="subtask">Подзадача: Отправка SDEK:</h1>
    <div class="countdown" id="countdownSDEK">00:00:00</div>
    <input type="checkbox" id="checkSDEK" onchange="saveCheckboxState('checkSDEK')"> Завершено

    <h1 class="subtask">Подзадача: Билет из Великого Новгорода в Питер:</h1>
    <div class="countdown" id="countdownTicketFromVN">00:00:00</div>
    <input type="checkbox" id="checkTicketFromVN" onchange="saveCheckboxState('checkTicketFromVN')"> Завершено

    <h2>Добавить новую задачу:</h2>
    <input type="text" id="taskInput" placeholder="Введите новую задачу">
    <button onclick="addTask()">Добавить задачу</button>

    <h2>Список задач:</h2>
    <ul id="tasksList"></ul>

    <script>
        // Ваша конфигурация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAjNl_Gd32-34qamgfVctFqNSzZa8QbAyM",
            authDomain: "xrysriki.firebaseapp.com",
            databaseURL: "https://xrysriki-default-rtdb.firebaseio.com",
            projectId: "xrysriki",
            storageBucket: "xrysriki.firebasestorage.app",
            messagingSenderId: "724701954108",
            appId: "1:724701954108:web:9c275e4e6806d066df4339",
            measurementId: "G-FG4NZ3379D"
        };

        // Инициализация Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Загрузка состояния при загрузке страницы
        document.addEventListener("DOMContentLoaded", () => {
            loadCheckboxState("checkMeeting");
            loadCheckboxState("checkTicket");
            loadCheckboxState("checkSDEK");
            loadCheckboxState("checkTicketFromVN");
            startCountdowns();
            loadTasks();
        });

        // Функция запуска отсчетов
        function startCountdowns() {
            const meetingDate = new Date("2024-11-30T00:00:00").getTime();
            const ticketDate = new Date("2024-11-05T00:00:00").getTime();
            const sdekDate = new Date("2024-11-28T00:00:00").getTime();
            const ticketFromVNDate = new Date("2024-11-10T00:00:00").getTime(); // Примерная дата

            setInterval(() => updateCountdown(meetingDate, "countdownMeeting"), 1000);
            setInterval(() => updateCountdown(ticketDate, "countdownTicket"), 1000);
            setInterval(() => updateCountdown(sdekDate, "countdownSDEK"), 1000);
            setInterval(() => updateCountdown(ticketFromVNDate, "countdownTicketFromVN"), 1000);
        }

        // Обновление отсчета
        function updateCountdown(targetDate, elementId) {
            const now = new Date().getTime();
            const distance = targetDate - now;

            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById(elementId).innerHTML = `${hours}ч ${minutes}м ${seconds}с`;

            if (distance < 0) {
                document.getElementById(elementId).innerHTML = "Время вышло";
            }
        }

        // Сохранение состояния чекбоксов в Firebase
        function saveCheckboxState(id) {
            const checkbox = document.getElementById(id);
            database.ref(`checkboxStates/${id}`).set(checkbox.checked);
            checkbox.classList.toggle("strikethrough", checkbox.checked);
        }

        // Загрузка состояния чекбокса из Firebase
        function loadCheckboxState(checkboxId) {
            database.ref(`checkboxStates/${checkboxId}`).once('value').then((snapshot) => {
                const checked = snapshot.val() || false; // значение по умолчанию false
                document.getElementById(checkboxId).checked = checked;
                document.getElementById(checkboxId).classList.toggle("strikethrough", checked);
            });
        }

        // Функция для добавления новой задачи
        function addTask() {
            const taskInput = document.getElementById("taskInput");
            const taskValue = taskInput.value;
            if (taskValue) {
                const newTaskRef = database.ref("tasks").push();
                newTaskRef.set({
                    name: taskValue,
                    completed: false
                });
                taskInput.value = "";
            }
        }

        // Загрузка задач из Firebase
        function loadTasks() {
            database.ref("tasks").on('value', (snapshot) => {
                const tasks = snapshot.val();
                const tasksList = document.getElementById("tasksList");
                tasksList.innerHTML = "";
                for (const key in tasks) {
                    const taskItem = document.createElement("li");
                    taskItem.textContent = tasks[key].name;
                    tasksList.appendChild(taskItem);
                }
            });
        }
    </script>
</body>
</html>
